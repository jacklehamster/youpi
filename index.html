<!DOCTYPE html>
<html style="height:100%">
<head><title>YouPi</title>
    
<script src="https://www.youtube.com/iframe_api"></script>
<script>
        var videoID = getParameterByName("videoID");
        var start = getSeconds(getParameterByName("start","0"));
        var end = getSeconds(getParameterByName("end","0"));
        var mute = getParameterByName("mute");
        var looping = false;
        if(end<start)
            end = 0;
    
        function getSeconds(time) {
            var splits = time.split(":");
            var seconds = parseFloat(splits.pop());
            if(splits.length)
                seconds += parseFloat(splits.pop())*60;
            if(splits.length)
                seconds += parseFloat(splits.pop())*3600;
            return seconds;
        }
    
        function getParameterByName(name,defaultValue) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                results = regex.exec(location.search);
            return results === null ? defaultValue 
            : decodeURIComponent(results[1].replace(/\+/g, " "));
        }    
    
        function onYouTubeIframeAPIReady() {
            if(videoID) {
                player = new YT.Player('player', {
                    width: '100%',
                    height:'100%',
                    videoId: videoID,
                    playerVars: { 
                        controls: 0, 
                        autohide:1,
                        modestbranding:1,
                        origin:document.domain, 
                        disablekb :1,
                        enablejsapi :1 
                    },
                    events: {
                        onReady: onPlayerReady,
                        onStateChange: onPlayerStateChange
                    }
                });
            }
            else {
                var instructions = document.getElementById("instructions");
                instructions.innerHTML = instructions.innerHTML.split("%URL").join(document.URL);
                instructions.style.display="";
                document.body.style.margin = "5px";
            }
        }
    
        function onPlayerStateChange(event) {
            console.log(event.data);
            if(event.data==YT.PlayerState.ENDED) {
                playSeek(true);
            }
            else if(event.data==YT.PlayerState.PLAYING && !looping) {
                looping = true;
                setInterval(playSeek,1000*(end-start),false);
            }
        }
    
        function onPlayerReady(event) {
            document.title = player.getVideoData().title;
            if(mute) {
                player.mute();
            }
            playSeek(true);
        }
    
        function playSeek(force) {
            if(force || end && player.getPlayerState()==YT.PlayerState.PLAYING)
                player.seekTo(start);
        }
    
</script>
</head>
<body style="margin:0px; height:100%">
<div id="player"></div>
<div id="instructions" style="display:none">
    <h3>Usage:</h3>
    <ul>
    <li><b>Loop a video:</b>
    %URL?<font color='green'>videoID=&lt;videoID&gt;</font><br>
    <i>ex: <a href="?videoID=Kaouy4QT9vE">
        %URL?videoID=Kaouy4QT9vE</a></i><br>
    </li>
    <li><b>Loop a video muted:</b>
    %URL?<font color='green'>videoID=&lt;videoID&gt;&amp;mute=1</font><br>
    <i>ex: <a href="?videoID=06kXXJUddHQ&mute=1">
        %URL?videoID=06kXXJUddHQ&amp;mute=1</a></i><br>
    </li>
    <li><b>Loop a video from START to END:</b>
    %URL?<font color='green'>video=&lt;videoID&gt;</font>&amp;<font color='green'>start=&lt;START&gt;</font>&amp;<font color='green'>end=&lt;END&gt;</font><br>
    <i>ex: <a href="?videoID=2VzE8Ii12Js&start=1:04.7&end=1:18.3">
        %URL?videoID=ptFt1ffCFf0&amp;start=1:02&amp;end=1:11</a></i>
    </li>
    <li><b>You can use this in an iframe:</b><br>
        <i>ex: &lt;iframe src="%URL?videoID=vbU2VXGjQj8&amplstart=4:24&amp;end=4:29.9"&gt;&lt;/iframe&gt;</i><br>
        <iframe src="?videoID=vbU2VXGjQj8&start=4:24&end=4:29.9"></iframe>
    </li>
    </ul>
    <h6>
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Youpi</span> by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">jacklehamster</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/jacklehamster/youpi" rel="dct:source">https://github.com/jacklehamster/youpi</a>.    
    </h6>
</div>

</body>
</html>
